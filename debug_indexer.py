from models.indexer_model import IndexerModule
import torch

import lovely_tensors as lt
lt.monkey_patch()

im = IndexerModule(
    lattice_size=50000,
    num_iterations=5,
    error_precision=0.0012,
    filter_precision=0.00075,
    filter_min_num_spots=6
)

initial_cell = torch.tensor([
    [78.3, 0., 0.],
    [0., 78.3, 0.],
    [0., 0., 37.96]
])

reciprocal_spots = torch.tensor([[[ 0.1541,  0.2161,  0.0406],
         [ 0.2952, -0.1474,  0.0637],
         [-0.2827,  0.0114,  0.0463],
         [-0.1250, -0.3453,  0.0796],
         [ 0.0477, -0.0839,  0.0053],
         [-0.0687,  0.1101,  0.0095],
         [-0.1414,  0.0850,  0.0155],
         [-0.3436, -0.2162,  0.0983],
         [ 0.2759,  0.0282,  0.0445],
         [-0.0870, -0.2437,  0.0386],
         [-0.0231, -0.2718,  0.0430],
         [-0.2270, -0.0192,  0.0297],
         [-0.1744,  0.0420,  0.0183],
         [ 0.2179, -0.2211,  0.0561],
         [ 0.0357, -0.2674,  0.0420],
         [-0.2807, -0.0272,  0.0460],
         [ 0.3436, -0.1064,  0.0762],
         [-0.0872, -0.1943,  0.0259],
         [ 0.2404,  0.0771,  0.0367],
         [ 0.2107,  0.0757,  0.0287],
         [-0.0359, -0.2093,  0.0258],
         [-0.0970, -0.2237,  0.0342],
         [-0.0904,  0.0361,  0.0054],
         [ 0.0241, -0.2069,  0.0248],
         [-0.2555,  0.0547,  0.0394],
         [ 0.2689, -0.2192,  0.0706],
         [-0.0369,  0.2576,  0.0390],
         [ 0.3522,  0.1711,  0.0911],
         [-0.0861, -0.0072,  0.0042],
         [ 0.1144,  0.2166,  0.0345],
         [ 0.0931, -0.0992,  0.0105],
         [-0.1426,  0.1296,  0.0212],
         [ 0.1271, -0.2233,  0.0380],
         [-0.0162,  0.1895,  0.0206],
         [-0.0370, -0.0883,  0.0052],
         [ 0.0319,  0.3169,  0.0591],
         [ 0.1214,  0.1558,  0.0223],
         [-0.0520, -0.2331,  0.0328],
         [ 0.0894,  0.0164,  0.0047],
         [ 0.0861,  0.2199,  0.0320],
         [ 0.1730, -0.0114,  0.0171],
         [ 0.0778, -0.1160,  0.0111],
         [-0.1216, -0.2404,  0.0419],
         [ 0.1881, -0.1913,  0.0415],
         [ 0.2235,  0.1173,  0.0367],
         [ 0.0355, -0.2380,  0.0333],
         [ 0.0190,  0.3168,  0.0587],
         [ 0.0915, -0.0327,  0.0053],
         [ 0.2798, -0.0393,  0.0462],
         [ 0.0188,  0.3410,  0.0684],
         [-0.1297, -0.2381,  0.0424],
         [-0.2345,  0.0872,  0.0360],
         [-0.0032,  0.1898,  0.0205],
         [ 0.0580,  0.2231,  0.0305],
         [-0.1309,  0.1833,  0.0291],
         [-0.1689,  0.1539,  0.0299],
         [ 0.0486,  0.0538,  0.0030],
         [ 0.1802, -0.2113,  0.0446],
         [ 0.0758, -0.0871,  0.0075],
         [ 0.1110,  0.2161,  0.0339],
         [ 0.1751,  0.1878,  0.0380],
         [-0.1358,  0.0255,  0.0108],
         [-0.1638, -0.2830,  0.0625],
         [ 0.2464, -0.0853,  0.0392],
         [-0.2200,  0.1483,  0.0406],
         [ 0.0493, -0.2491,  0.0371],
         [-0.2154, -0.2255,  0.0566],
         [-0.0676, -0.0384,  0.0034],
         [-0.1775, -0.1283,  0.0274],
         [-0.2082,  0.2017,  0.0487],
         [ 0.2303, -0.1232,  0.0393],
         [-0.0486, -0.3061,  0.0559],
         [ 0.1423, -0.2409,  0.0453],
         [ 0.0605,  0.1912,  0.0230],
         [-0.0675,  0.2133,  0.0287],
         [ 0.0062,  0.3164,  0.0584],
         [ 0.2643,  0.1550,  0.0546],
         [-0.2293, -0.0754,  0.0335],
         [-0.1644, -0.1575,  0.0297],
         [ 0.0507,  0.0012,  0.0015]],

        [[ 0.1396,  0.2546,  0.0489],
         [-0.3012,  0.0155,  0.0528],
         [ 0.0229, -0.1116,  0.0073],
         [ 0.1762, -0.3489,  0.0907],
         [-0.0325,  0.3716,  0.0822],
         [-0.0912,  0.1844,  0.0242],
         [ 0.3475, -0.2257,  0.1027],
         [-0.1862, -0.2437,  0.0547],
         [-0.3090, -0.1067,  0.0624],
         [-0.1124,  0.0561,  0.0089],
         [-0.2204,  0.3209,  0.0900],
         [ 0.1804, -0.0897,  0.0232],
         [ 0.3708,  0.0340,  0.0819],
         [-0.2758,  0.0418,  0.0450],
         [ 0.3268,  0.0956,  0.0679],
         [ 0.1192, -0.3799,  0.0944],
         [-0.2295,  0.2207,  0.0591],
         [ 0.0955,  0.2530,  0.0422],
         [-0.2500, -0.0644,  0.0384],
         [ 0.2920,  0.2077,  0.0756],
         [-0.0169,  0.1371,  0.0108],
         [ 0.0445, -0.3492,  0.0728],
         [-0.0441,  0.3884,  0.0908],
         [ 0.1505, -0.3770,  0.0983],
         [-0.0115,  0.0768,  0.0034],
         [-0.2143, -0.1394,  0.0376],
         [-0.1271,  0.0272,  0.0096],
         [ 0.2900,  0.0597,  0.0508],
         [-0.0329,  0.0768,  0.0039],
         [ 0.1012, -0.2601,  0.0451],
         [ 0.1849,  0.0015,  0.0195],
         [-0.2119, -0.2852,  0.0742],
         [-0.1610,  0.0465,  0.0160],
         [-0.2206, -0.0310,  0.0284],
         [ 0.3097,  0.1295,  0.0660],
         [-0.1672, -0.0761,  0.0192],
         [-0.3931,  0.1115,  0.0997],
         [ 0.2322, -0.0022,  0.0309],
         [ 0.1552, -0.1035,  0.0198],
         [-0.1715,  0.2738,  0.0609],
         [-0.1593, -0.1290,  0.0240],
         [ 0.3031, -0.2651,  0.0966],
         [-0.3238,  0.1479,  0.0746],
         [ 0.2533,  0.1267,  0.0464],
         [ 0.1133, -0.3548,  0.0820],
         [ 0.0923, -0.1094,  0.0116],
         [ 0.1982,  0.2468,  0.0584],
         [ 0.3144,  0.0084,  0.0576],
         [-0.3104,  0.1842,  0.0768],
         [ 0.3220,  0.1072,  0.0675],
         [-0.0630,  0.2656,  0.0430],
         [-0.2696, -0.0064,  0.0420],
         [ 0.1539,  0.1881,  0.0339],
         [-0.0917, -0.1917,  0.0258],
         [ 0.0487, -0.0899,  0.0059],
         [ 0.2435, -0.0707,  0.0370],
         [-0.2513,  0.0110,  0.0364],
         [-0.1408, -0.1626,  0.0265],
         [-0.1189,  0.1767,  0.0260],
         [ 0.2284, -0.1558,  0.0442],
         [-0.2768, -0.0168,  0.0444],
         [ 0.1251, -0.2127,  0.0350],
         [ 0.2645,  0.0105,  0.0404],
         [ 0.0373, -0.1531,  0.0141],
         [-0.0552,  0.1013,  0.0075],
         [ 0.1597,  0.1462,  0.0268],
         [-0.2162,  0.0842,  0.0309],
         [-0.0462,  0.2686,  0.0429],
         [-0.1396, -0.0900,  0.0157],
         [ 0.1974, -0.2097,  0.0481],
         [ 0.0714, -0.2212,  0.0310],
         [-0.1728,  0.1844,  0.0368],
         [-0.0986, -0.2547,  0.0431],
         [-0.0361,  0.1119,  0.0078],
         [-0.1807,  0.0922,  0.0235],
         [ 0.2143, -0.0186,  0.0265],
         [-0.1676,  0.1285,  0.0255],
         [-0.1653, -0.1178,  0.0235],
         [ 0.1913,  0.0609,  0.0230],
         [-0.1573,  0.0026,  0.0141]],

        [[-0.0953,  0.2744,  0.0489],
         [-0.2618, -0.1312,  0.0497],
         [-0.3272,  0.0536,  0.0643],
         [ 0.3160, -0.1646,  0.0747],
         [ 0.3173,  0.1375,  0.0702],
         [-0.2240,  0.2843,  0.0772],
         [ 0.1362, -0.1320,  0.0205],
         [-0.0836,  0.2701,  0.0463],
         [ 0.1714,  0.0037,  0.0167],
         [ 0.3954,  0.0359,  0.0938],
         [ 0.3048, -0.1527,  0.0681],
         [-0.0503, -0.2695,  0.0434],
         [ 0.1009,  0.2465,  0.0409],
         [ 0.0408,  0.3598,  0.0772],
         [ 0.0912,  0.1580,  0.0190],
         [-0.2456,  0.2007,  0.0586],
         [-0.1401, -0.1251,  0.0201],
         [-0.1286,  0.2260,  0.0390],
         [ 0.3172, -0.0407,  0.0597],
         [ 0.0218, -0.1335,  0.0104],
         [ 0.3833, -0.1070,  0.0943],
         [ 0.3834,  0.1484,  0.1010],
         [ 0.0072,  0.3193,  0.0595],
         [-0.0580,  0.0302,  0.0024],
         [ 0.2833, -0.0894,  0.0512],
         [ 0.1362,  0.1637,  0.0259],
         [ 0.2590, -0.1968,  0.0618],
         [ 0.2160,  0.1778,  0.0453],
         [-0.2020, -0.2814,  0.0704],
         [ 0.0314,  0.2497,  0.0364],
         [-0.0279, -0.2863,  0.0479],
         [ 0.1939, -0.0130,  0.0215],
         [-0.2345,  0.1959,  0.0543],
         [-0.1176, -0.1808,  0.0266],
         [-0.1056,  0.2174,  0.0335],
         [-0.1158,  0.0212,  0.0079],
         [-0.1296,  0.2570,  0.0480],
         [-0.1063,  0.2483,  0.0421],
         [-0.0599,  0.2613,  0.0415],
         [ 0.2730,  0.0705,  0.0460],
         [ 0.0323, -0.1844,  0.0200],
         [ 0.0222,  0.1617,  0.0151],
         [ 0.1708,  0.1422,  0.0283],
         [-0.0824, -0.1551,  0.0176],
         [-0.1399,  0.1997,  0.0342],
         [-0.0369, -0.2272,  0.0304],
         [ 0.2499, -0.0982,  0.0416],
         [-0.0938,  0.2131,  0.0311],
         [-0.1051,  0.1866,  0.0262],
         [ 0.0311, -0.2313,  0.0312],
         [-0.0725, -0.2527,  0.0398],
         [-0.1989, -0.1419,  0.0343],
         [-0.0932,  0.1823,  0.0239],
         [ 0.1911, -0.2239,  0.0503],
         [ 0.3283, -0.0921,  0.0681],
         [ 0.1708, -0.0753,  0.0199],
         [ 0.2391,  0.0611,  0.0350],
         [ 0.1799,  0.2607,  0.0585],
         [-0.1172,  0.2218,  0.0362],
         [ 0.0537, -0.2479,  0.0370],
         [-0.1647, -0.2016,  0.0391],
         [-0.1182,  0.2525,  0.0449],
         [-0.0704,  0.2043,  0.0267],
         [ 0.2277,  0.1042,  0.0361],
         [ 0.1485, -0.0189,  0.0127],
         [ 0.1481, -0.0968,  0.0178],
         [-0.2094,  0.1261,  0.0343],
         [ 0.2043, -0.1423,  0.0357],
         [-0.0821,  0.2086,  0.0288],
         [ 0.1455, -0.2294,  0.0426],
         [-0.1276,  0.0256,  0.0096],
         [-0.0584, -0.1253,  0.0108],
         [-0.1870, -0.1461,  0.0323],
         [ 0.1255, -0.0410,  0.0099],
         [-0.0466, -0.0910,  0.0059],
         [ 0.1019,  0.2151,  0.0325],
         [-0.0119,  0.1127,  0.0073],
         [ 0.0687, -0.0030,  0.0027],
         [-0.0928,  0.0820,  0.0087],
         [ 0.2166,  0.0777,  0.0304]],

        [[ 0.2902, -0.0676,  0.0515],
         [-0.1678, -0.0012,  0.0160],
         [-0.3216,  0.2695,  0.1055],
         [ 0.2579, -0.2187,  0.0670],
         [ 0.2231,  0.2616,  0.0693],
         [-0.0763,  0.3051,  0.0576],
         [-0.3843,  0.0287,  0.0881],
         [-0.0762,  0.4225,  0.1108],
         [-0.1502,  0.4278,  0.1246],
         [-0.3428, -0.1984,  0.0933],
         [-0.3761, -0.1516,  0.0981],
         [ 0.4253,  0.1026,  0.1154],
         [-0.4402,  0.0743,  0.1205],
         [-0.2396, -0.4564,  0.1651],
         [ 0.1122,  0.2495,  0.0432],
         [-0.3312,  0.3857,  0.1601],
         [-0.1451,  0.0817,  0.0158],
         [ 0.2498, -0.3565,  0.1141],
         [-0.0620,  0.0548,  0.0039],
         [ 0.0241,  0.0735,  0.0034],
         [ 0.0741, -0.0440,  0.0042],
         [ 0.1113,  0.1079,  0.0136],
         [ 0.1430,  0.1697,  0.0282],
         [ 0.0979,  0.2984,  0.0575],
         [ 0.0236,  0.0538,  0.0020],
         [ 0.1530, -0.1664,  0.0293],
         [-0.1388,  0.0309,  0.0115],
         [ 0.3870, -0.1803,  0.1095],
         [-0.2859, -0.1345,  0.0582],
         [-0.2100,  0.1841,  0.0451],
         [-0.1412,  0.0537,  0.0130],
         [ 0.0318,  0.0849,  0.0046],
         [-0.4243, -0.0383,  0.1090],
         [-0.2052, -0.1201,  0.0325],
         [ 0.2287, -0.0129,  0.0301],
         [-0.1820, -0.2516,  0.0561],
         [-0.0245,  0.2925,  0.0500],
         [-0.1707, -0.3570,  0.0932],
         [-0.0974,  0.0500,  0.0068],
         [-0.0314, -0.0424,  0.0016],
         [ 0.0339, -0.3491,  0.0723],
         [-0.4225, -0.0359,  0.1079],
         [ 0.3433,  0.1746,  0.0880],
         [-0.0721,  0.0586,  0.0049],
         [-0.0773, -0.3196,  0.0632],
         [ 0.1829, -0.0862,  0.0233],
         [-0.3313, -0.3640,  0.1491],
         [ 0.2561, -0.3990,  0.1373],
         [ 0.3277,  0.1195,  0.0715],
         [-0.0922,  0.3484,  0.0765],
         [-0.1109,  0.2921,  0.0568],
         [ 0.2310, -0.3887,  0.1239],
         [-0.0671,  0.4024,  0.0993],
         [ 0.0940, -0.1743,  0.0224],
         [-0.0240,  0.2258,  0.0295],
         [-0.2910,  0.0107,  0.0492],
         [-0.2473, -0.3723,  0.1208],
         [-0.0719,  0.4125,  0.1050],
         [-0.3022,  0.2362,  0.0872],
         [ 0.1693,  0.3461,  0.0880],
         [ 0.2613,  0.0056,  0.0394],
         [ 0.0429, -0.0206,  0.0013],
         [ 0.0501,  0.2557,  0.0391],
         [ 0.2722,  0.2688,  0.0867],
         [ 0.2062,  0.2107,  0.0504],
         [ 0.1537, -0.1486,  0.0261],
         [-0.2429, -0.1389,  0.0453],
         [-0.2053, -0.0969,  0.0295],
         [ 0.2004,  0.0791,  0.0266],
         [-0.1671,  0.1862,  0.0360],
         [ 0.0065,  0.1124,  0.0072],
         [-0.1425, -0.2518,  0.0485],
         [ 0.2726,  0.1223,  0.0518],
         [-0.1369, -0.3893,  0.1018],
         [-0.2240, -0.1066,  0.0354],
         [ 0.3024, -0.0414,  0.0541],
         [-0.0740, -0.2645,  0.0436],
         [-0.2537,  0.1391,  0.0485],
         [-0.2045,  0.0662,  0.0264],
         [ 0.0991,  0.0344,  0.0062]],

        [[-0.3107,  0.0999,  0.0622],
         [ 0.0429, -0.0386,  0.0019],
         [-0.0978, -0.3737,  0.0885],
         [ 0.2660, -0.2152,  0.0686],
         [-0.1519, -0.4374,  0.1304],
         [ 0.3599, -0.3384,  0.1503],
         [ 0.2836,  0.0872,  0.0511],
         [ 0.2665,  0.0162,  0.0411],
         [ 0.3869, -0.0990,  0.0950],
         [ 0.0231, -0.3229,  0.0612],
         [ 0.0946,  0.3501,  0.0775],
         [-0.2715, -0.2100,  0.0691],
         [-0.2767, -0.2911,  0.0961],
         [-0.1727,  0.3454,  0.0884],
         [ 0.0865,  0.3410,  0.0727],
         [ 0.2328,  0.0292,  0.0316],
         [ 0.0706,  0.3232,  0.0640],
         [ 0.2511, -0.2395,  0.0707],
         [-0.3173,  0.2670,  0.1029],
         [ 0.1110,  0.0610,  0.0091],
         [-0.1141,  0.2595,  0.0465],
         [ 0.1332, -0.3155,  0.0688],
         [-0.3618, -0.1599,  0.0931],
         [ 0.1990, -0.2622,  0.0633],
         [-0.1286, -0.2977,  0.0614],
         [ 0.2007,  0.0817,  0.0269],
         [ 0.0256, -0.3946,  0.0930],
         [ 0.1773, -0.3017,  0.0719],
         [-0.2113,  0.2944,  0.0774],
         [ 0.1622,  0.0306,  0.0155],
         [ 0.0460, -0.3486,  0.0727],
         [-0.2781, -0.2255,  0.0755],
         [-0.2957,  0.1241,  0.0600],
         [-0.3363,  0.1504,  0.0801],
         [-0.1354, -0.3128,  0.0681],
         [ 0.0985, -0.0354,  0.0062],
         [-0.1299, -0.2320,  0.0408],
         [-0.0054,  0.2738,  0.0433],
         [ 0.3032, -0.0983,  0.0592],
         [-0.0819,  0.1717,  0.0206],
         [-0.2317,  0.3072,  0.0878],
         [-0.0235,  0.3332,  0.0653],
         [ 0.3547,  0.1674,  0.0914],
         [-0.2337, -0.3308,  0.0978],
         [-0.3510,  0.1262,  0.0822],
         [-0.3753, -0.1905,  0.1062],
         [ 0.0503, -0.2026,  0.0249],
         [-0.0514,  0.2136,  0.0276],
         [-0.0157, -0.1369,  0.0108],
         [ 0.0395, -0.3641,  0.0791],
         [ 0.2578, -0.1649,  0.0545],
         [ 0.3504,  0.2514,  0.1118],
         [ 0.1006,  0.1889,  0.0262],
         [-0.2269,  0.0937,  0.0346],
         [-0.1160,  0.2132,  0.0339],
         [-0.1152, -0.2669,  0.0490],
         [ 0.3257, -0.1243,  0.0714],
         [-0.3619, -0.1007,  0.0835],
         [ 0.0627,  0.3144,  0.0599],
         [-0.1219, -0.2824,  0.0550],
         [ 0.2577, -0.1055,  0.0448],
         [-0.2563,  0.0448,  0.0390],
         [ 0.0498, -0.0837,  0.0054],
         [-0.1771, -0.3394,  0.0868],
         [ 0.1828, -0.1020,  0.0250],
         [ 0.1534, -0.2101,  0.0390],
         [-0.0096,  0.1809,  0.0187],
         [ 0.0877, -0.2634,  0.0446],
         [ 0.0948,  0.2264,  0.0346],
         [-0.0505, -0.2665,  0.0425],
         [ 0.1093, -0.2238,  0.0357],
         [ 0.0583, -0.2527,  0.0388],
         [ 0.1711,  0.0924,  0.0216],
         [ 0.1280,  0.1318,  0.0192],
         [ 0.0895,  0.0808,  0.0082],
         [ 0.1916,  0.0199,  0.0212],
         [-0.2296, -0.1840,  0.0502],
         [-0.2925, -0.0189,  0.0498],
         [-0.0402,  0.1387,  0.0118],
         [ 0.0352, -0.1080,  0.0073]],

        [[-0.0615, -0.3213,  0.0625],
         [ 0.1555, -0.2917,  0.0639],
         [ 0.0297,  0.3280,  0.0634],
         [ 0.0962, -0.2143,  0.0317],
         [-0.0814,  0.3678,  0.0839],
         [-0.2228, -0.3450,  0.1008],
         [ 0.1253,  0.2770,  0.0537],
         [-0.3286,  0.2630,  0.1062],
         [ 0.2133,  0.1398,  0.0374],
         [ 0.0280,  0.0795,  0.0040],
         [ 0.0042,  0.2864,  0.0475],
         [-0.0639,  0.1015,  0.0081],
         [ 0.1530, -0.0812,  0.0171],
         [-0.4154, -0.1793,  0.1240],
         [ 0.2526, -0.0941,  0.0419],
         [-0.0514,  0.2703,  0.0438],
         [-0.0436,  0.1226,  0.0096],
         [-0.0643,  0.3117,  0.0591],
         [ 0.4391,  0.1302,  0.1273],
         [-0.3341,  0.0747,  0.0687],
         [-0.2644, -0.2739,  0.0858],
         [ 0.1235,  0.0723,  0.0116],
         [-0.1258,  0.4279,  0.1202],
         [-0.0140,  0.1791,  0.0184],
         [-0.1986,  0.1451,  0.0348],
         [-0.2010,  0.2417,  0.0576],
         [-0.1500, -0.1463,  0.0251],
         [ 0.1497,  0.1994,  0.0358],
         [ 0.1830, -0.3381,  0.0876],
         [-0.4388, -0.0369,  0.1170],
         [-0.1779, -0.1088,  0.0249],
         [-0.2124, -0.0984,  0.0314],
         [ 0.0956, -0.0149,  0.0053],
         [ 0.2954,  0.2987,  0.1058],
         [ 0.2562, -0.1682,  0.0546],
         [-0.2559, -0.0872,  0.0422],
         [ 0.0564,  0.2258,  0.0311],
         [-0.0022,  0.1354,  0.0104],
         [-0.1991,  0.3251,  0.0861],
         [ 0.2160,  0.1045,  0.0331],
         [ 0.0755, -0.0734,  0.0063],
         [ 0.2216,  0.3223,  0.0909],
         [ 0.2748,  0.2707,  0.0882],
         [-0.1508, -0.1851,  0.0327],
         [-0.0415, -0.2994,  0.0531],
         [ 0.1603,  0.0420,  0.0156],
         [ 0.1525,  0.3150,  0.0719],
         [ 0.3623,  0.1531,  0.0920],
         [-0.0987, -0.1689,  0.0218],
         [-0.1358, -0.2261,  0.0401],
         [-0.2488,  0.2759,  0.0815],
         [ 0.0947, -0.1033,  0.0111],
         [ 0.2150,  0.0050,  0.0265],
         [ 0.1656, -0.0250,  0.0160],
         [ 0.1210,  0.3371,  0.0755],
         [-0.2128, -0.1016,  0.0319],
         [-0.0782,  0.3939,  0.0961],
         [-0.2951,  0.2528,  0.0896],
         [-0.2946, -0.0009,  0.0503],
         [-0.2699,  0.1786,  0.0611],
         [-0.2297, -0.0332,  0.0309],
         [-0.1528,  0.4190,  0.1202],
         [ 0.3703,  0.0210,  0.0812],
         [ 0.0450, -0.2284,  0.0311],
         [-0.3623,  0.0115,  0.0774],
         [-0.1096,  0.2066,  0.0314],
         [-0.1731,  0.0301,  0.0176],
         [ 0.2075, -0.2302,  0.0559],
         [ 0.1270, -0.0761,  0.0124],
         [ 0.2766,  0.2135,  0.0717],
         [ 0.3092, -0.1753,  0.0743],
         [ 0.0985,  0.0293,  0.0060],
         [-0.0698, -0.1891,  0.0232],
         [ 0.1940, -0.0242,  0.0218],
         [ 0.0645, -0.2700,  0.0445],
         [-0.2980,  0.1000,  0.0575],
         [ 0.3401, -0.0143,  0.0679],
         [ 0.0284, -0.1047,  0.0067],
         [-0.1260,  0.0895,  0.0136],
         [ 0.0554, -0.0958,  0.0069]],

        [[-0.0501, -0.2242,  0.0303],
         [ 0.1981,  0.0971,  0.0279],
         [-0.2258, -0.0918,  0.0341],
         [-0.0399,  0.1847,  0.0203],
         [ 0.3406, -0.3295,  0.1372],
         [-0.0173,  0.3944,  0.0927],
         [ 0.0019,  0.4093,  0.1001],
         [ 0.1699,  0.1194,  0.0246],
         [-0.0878, -0.4824,  0.1478],
         [-0.2172,  0.0458,  0.0282],
         [-0.0372, -0.1018,  0.0066],
         [ 0.2208,  0.0378,  0.0287],
         [ 0.4147,  0.1900,  0.1262],
         [ 0.0482,  0.2025,  0.0248],
         [ 0.0360, -0.3737,  0.0833],
         [-0.1303, -0.0137,  0.0097],
         [-0.3134,  0.1368,  0.0685],
         [ 0.1028, -0.0340,  0.0066],
         [-0.2725,  0.2509,  0.0810],
         [-0.1136, -0.0979,  0.0128],
         [-0.0280, -0.2545,  0.0377],
         [ 0.0238, -0.0943,  0.0053],
         [-0.3235, -0.2140,  0.0893],
         [-0.3725, -0.3518,  0.1629],
         [-0.0355, -0.3187,  0.0600],
         [ 0.1668, -0.4275,  0.1279],
         [-0.3296,  0.1932,  0.0865],
         [-0.1406,  0.3137,  0.0693],
         [-0.3055,  0.1897,  0.0762],
         [ 0.0934,  0.0715,  0.0078],
         [-0.2528,  0.4242,  0.1501],
         [-0.0051,  0.1823,  0.0189],
         [ 0.1055,  0.1572,  0.0204],
         [-0.2250, -0.2435,  0.0643],
         [ 0.1158,  0.2744,  0.0515],
         [-0.0355, -0.2443,  0.0350],
         [-0.0415, -0.2576,  0.0392],
         [-0.1777,  0.4093,  0.1204],
         [ 0.0687,  0.3938,  0.0952],
         [ 0.0576, -0.2550,  0.0394],
         [-0.0266,  0.3864,  0.0890],
         [-0.0284,  0.2103,  0.0257],
         [-0.0694,  0.1457,  0.0148],
         [-0.0578, -0.2141,  0.0282],
         [-0.2496,  0.3019,  0.0911],
         [ 0.0929,  0.0688,  0.0076],
         [ 0.2049,  0.3863,  0.1152],
         [ 0.0318,  0.2928,  0.0503],
         [ 0.1379, -0.2276,  0.0408],
         [-0.2330, -0.2521,  0.0691],
         [-0.1589, -0.1560,  0.0284],
         [-0.1348,  0.3358,  0.0771],
         [-0.2134, -0.2261,  0.0563],
         [-0.3369, -0.1044,  0.0731],
         [ 0.2060, -0.3857,  0.1152],
         [ 0.3046, -0.2684,  0.0983],
         [ 0.1183,  0.1405,  0.0192],
         [-0.0359,  0.3786,  0.0856],
         [ 0.0968,  0.2588,  0.0441],
         [-0.2652, -0.0740,  0.0438],
         [ 0.0723,  0.1892,  0.0234],
         [ 0.1734, -0.1398,  0.0284],
         [ 0.1646,  0.0842,  0.0195],
         [ 0.1429,  0.3679,  0.0926],
         [ 0.1481, -0.1636,  0.0279],
         [ 0.1069,  0.1149,  0.0140],
         [-0.0513,  0.1590,  0.0159],
         [-0.0430, -0.2343,  0.0326],
         [ 0.1675,  0.1972,  0.0386],
         [ 0.0884,  0.3392,  0.0722],
         [-0.2121,  0.1746,  0.0436],
         [-0.1823, -0.0178,  0.0191],
         [ 0.1769,  0.2049,  0.0423],
         [ 0.1581,  0.1894,  0.0350],
         [-0.1877,  0.2436,  0.0550],
         [ 0.1061,  0.2667,  0.0477],
         [-0.0725,  0.0440,  0.0041],
         [ 0.0915,  0.0536,  0.0064],
         [-0.0393, -0.1239,  0.0096],
         [-0.1737,  0.1353,  0.0278]],

        [[ 0.1709,  0.2435,  0.0514],
         [-0.0598, -0.3102,  0.0581],
         [ 0.2500, -0.1829,  0.0558],
         [ 0.1603, -0.2026,  0.0384],
         [-0.2021,  0.1800,  0.0423],
         [-0.2153,  0.0357,  0.0273],
         [-0.1781,  0.0769,  0.0215],
         [-0.0590, -0.1570,  0.0160],
         [-0.0428,  0.3109,  0.0573],
         [ 0.1714,  0.3151,  0.0757],
         [-0.1557, -0.3661,  0.0942],
         [ 0.1601, -0.2379,  0.0476],
         [ 0.2750,  0.0225,  0.0440],
         [ 0.1452,  0.3277,  0.0756],
         [ 0.2396, -0.1080,  0.0398],
         [-0.1241, -0.1569,  0.0228],
         [ 0.0440, -0.3913,  0.0922],
         [ 0.2917, -0.0649,  0.0518],
         [ 0.2346,  0.2993,  0.0856],
         [-0.3217, -0.1120,  0.0680],
         [ 0.1168, -0.2072,  0.0325],
         [ 0.0280,  0.1858,  0.0201],
         [ 0.2426, -0.1316,  0.0440],
         [-0.1795,  0.2129,  0.0449],
         [-0.1120,  0.1297,  0.0167],
         [ 0.3316, -0.1318,  0.0749],
         [ 0.2188,  0.1112,  0.0346],
         [ 0.0789, -0.1547,  0.0172],
         [-0.3313,  0.1853,  0.0853],
         [ 0.1294,  0.0711,  0.0124],
         [-0.0534,  0.2970,  0.0529],
         [ 0.0845,  0.0021,  0.0040],
         [-0.1659, -0.2429,  0.0502],
         [-0.0329,  0.1785,  0.0188],
         [ 0.1074, -0.1156,  0.0141],
         [-0.1661,  0.2808,  0.0622],
         [-0.1583, -0.2865,  0.0626],
         [-0.1967,  0.1425,  0.0339],
         [-0.0945,  0.2004,  0.0281],
         [-0.2719,  0.1621,  0.0584],
         [-0.0879, -0.2120,  0.0302],
         [ 0.2505,  0.1862,  0.0567],
         [ 0.0722, -0.2291,  0.0331],
         [-0.0298, -0.2273,  0.0301],
         [-0.2692,  0.0742,  0.0451],
         [-0.2064,  0.2482,  0.0608],
         [ 0.3042, -0.1210,  0.0626],
         [-0.2070, -0.2252,  0.0544],
         [-0.2869,  0.1162,  0.0557],
         [ 0.0247,  0.2691,  0.0421],
         [-0.0890,  0.1629,  0.0196],
         [ 0.1177,  0.2700,  0.0503],
         [ 0.0298,  0.3006,  0.0530],
         [ 0.2479, -0.0341,  0.0360],
         [-0.2156,  0.0347,  0.0273],
         [-0.1810,  0.0954,  0.0239],
         [ 0.1029, -0.2506,  0.0424],
         [-0.2134, -0.1971,  0.0489],
         [ 0.0403, -0.1356,  0.0113],
         [-0.1361,  0.0438,  0.0116],
         [ 0.2843,  0.0848,  0.0511],
         [-0.2438, -0.0359,  0.0349],
         [ 0.1467, -0.2809,  0.0585],
         [-0.0838,  0.0694,  0.0067],
         [ 0.1986, -0.0253,  0.0229],
         [ 0.0791, -0.0949,  0.0087],
         [ 0.2464,  0.0322,  0.0355],
         [-0.1237, -0.0973,  0.0141],
         [-0.0380,  0.2091,  0.0258],
         [ 0.0393, -0.2348,  0.0325],
         [ 0.1486, -0.0824,  0.0164],
         [ 0.2105, -0.0312,  0.0259],
         [ 0.0465, -0.1637,  0.0165],
         [-0.2454,  0.0121,  0.0347],
         [-0.2355,  0.0196,  0.0321],
         [-0.2256,  0.0271,  0.0296],
         [ 0.2676,  0.0496,  0.0428],
         [ 0.0866,  0.1732,  0.0214],
         [ 0.1341,  0.1091,  0.0170],
         [-0.0115,  0.0588,  0.0020]],

        [[-0.1202, -0.2783,  0.0534],
         [-0.1219, -0.2646,  0.0492],
         [-0.1672, -0.2186,  0.0438],
         [-0.2307,  0.2606,  0.0711],
         [ 0.1304,  0.1890,  0.0302],
         [ 0.2476, -0.2314,  0.0673],
         [-0.1253, -0.2439,  0.0434],
         [-0.2385,  0.1565,  0.0471],
         [ 0.0233,  0.1498,  0.0131],
         [ 0.1121,  0.3194,  0.0671],
         [ 0.1296, -0.2912,  0.0592],
         [ 0.3108,  0.1630,  0.0724],
         [-0.1576,  0.1155,  0.0218],
         [ 0.1389, -0.2258,  0.0405],
         [-0.0397,  0.3114,  0.0574],
         [ 0.0482,  0.2728,  0.0443],
         [-0.2043, -0.0648,  0.0263],
         [-0.2653,  0.2557,  0.0801],
         [ 0.2070,  0.3518,  0.0995],
         [ 0.2213,  0.1900,  0.0493],
         [ 0.2828, -0.1487,  0.0595],
         [-0.1445, -0.3090,  0.0682],
         [ 0.0464, -0.1728,  0.0182],
         [ 0.1709, -0.1368,  0.0274],
         [ 0.1798, -0.2507,  0.0554],
         [ 0.0898,  0.2840,  0.0515],
         [ 0.1278,  0.1895,  0.0300],
         [ 0.0254, -0.2457,  0.0351],
         [ 0.1780,  0.2036,  0.0422],
         [-0.0671, -0.1580,  0.0168],
         [ 0.2298,  0.1766,  0.0487],
         [ 0.1645,  0.1597,  0.0301],
         [-0.0814, -0.1320,  0.0137],
         [ 0.1042,  0.1717,  0.0230],
         [ 0.0076,  0.1179,  0.0079],
         [ 0.0890, -0.1613,  0.0193],
         [-0.2758,  0.3166,  0.1056],
         [-0.0162,  0.1729,  0.0172],
         [-0.0867, -0.2180,  0.0316],
         [-0.1381,  0.1780,  0.0291],
         [ 0.1868, -0.2713,  0.0634],
         [ 0.1146,  0.0972,  0.0128],
         [ 0.1790,  0.0463,  0.0195],
         [-0.1673, -0.0958,  0.0212],
         [-0.0026,  0.3293,  0.0634],
         [ 0.0179, -0.3802,  0.0858],
         [-0.2112, -0.2076,  0.0509],
         [-0.1923, -0.1641,  0.0368],
         [ 0.1210,  0.2004,  0.0314],
         [ 0.0214,  0.2814,  0.0461],
         [-0.1291,  0.1199,  0.0177],
         [-0.1809, -0.2884,  0.0679],
         [-0.1512, -0.1835,  0.0324],
         [ 0.1745, -0.1089,  0.0242],
         [ 0.1989,  0.1743,  0.0403],
         [-0.1225, -0.2610,  0.0482],
         [ 0.2326, -0.2040,  0.0557],
         [ 0.3452, -0.1216,  0.0790],
         [ 0.2932, -0.1098,  0.0571],
         [-0.0912,  0.2739,  0.0483],
         [ 0.1351, -0.1276,  0.0197],
         [-0.0828, -0.1773,  0.0219],
         [-0.0494,  0.1514,  0.0144],
         [ 0.0386, -0.2841,  0.0476],
         [-0.1819, -0.2413,  0.0531],
         [-0.1966,  0.0995,  0.0278],
         [-0.2239, -0.0310,  0.0293],
         [ 0.1069,  0.0730,  0.0095],
         [-0.2607,  0.0131,  0.0393],
         [ 0.1110,  0.0849,  0.0111],
         [-0.1266,  0.2113,  0.0349],
         [ 0.0512, -0.0161,  0.0016],
         [-0.1551,  0.2066,  0.0384],
         [-0.1760,  0.0447,  0.0188],
         [-0.1099, -0.0241,  0.0072],
         [-0.0734, -0.0761,  0.0063],
         [-0.1784,  0.1344,  0.0286],
         [ 0.0697,  0.2171,  0.0298],
         [-0.1058,  0.1922,  0.0276],
         [ 0.0039,  0.1060,  0.0064]],

        [[-0.2483,  0.1444,  0.0478],
         [-0.2294, -0.1827,  0.0499],
         [-0.2828,  0.0980,  0.0520],
         [ 0.2499,  0.1769,  0.0545],
         [-0.1596, -0.2964,  0.0664],
         [-0.0488,  0.0832,  0.0053],
         [-0.1552, -0.1041,  0.0199],
         [-0.0494, -0.4342,  0.1151],
         [ 0.1417, -0.1455,  0.0236],
         [-0.0960, -0.1238,  0.0139],
         [-0.1746, -0.0962,  0.0227],
         [-0.0413, -0.4012,  0.0970],
         [-0.2191, -0.1667,  0.0438],
         [-0.1886, -0.1574,  0.0347],
         [ 0.1042,  0.3454,  0.0767],
         [ 0.2149, -0.2573,  0.0658],
         [ 0.3574, -0.2728,  0.1224],
         [ 0.1753, -0.4962,  0.1729],
         [ 0.4196,  0.1574,  0.1215],
         [ 0.1610, -0.0066,  0.0148],
         [ 0.4523, -0.0988,  0.1304],
         [-0.0512,  0.0291,  0.0020],
         [-0.0530, -0.1618,  0.0165],
         [-0.4387,  0.0748,  0.1197],
         [ 0.2553,  0.1140,  0.0452],
         [ 0.1393,  0.1563,  0.0251],
         [-0.1379, -0.0679,  0.0134],
         [ 0.0694,  0.3107,  0.0591],
         [-0.3186, -0.2184,  0.0885],
         [-0.4029, -0.0632,  0.0993],
         [ 0.0365,  0.1307,  0.0104],
         [-0.1965, -0.1668,  0.0383],
         [-0.0982,  0.0377,  0.0063],
         [-0.2090, -0.1062,  0.0315],
         [ 0.1433,  0.0572,  0.0135],
         [-0.0186,  0.4468,  0.1209],
         [ 0.1271,  0.3593,  0.0860],
         [-0.3532,  0.0100,  0.0734],
         [-0.1297, -0.0406,  0.0105],
         [-0.0014,  0.1709,  0.0166],
         [ 0.1222, -0.0875,  0.0128],
         [ 0.2888,  0.0308,  0.0489],
         [-0.0742, -0.0198,  0.0033],
         [-0.2594, -0.1794,  0.0580],
         [-0.0540, -0.3544,  0.0756],
         [-0.3047, -0.1072,  0.0609],
         [-0.3620,  0.0447,  0.0784],
         [ 0.0891,  0.2031,  0.0282],
         [ 0.0384,  0.2587,  0.0394],
         [ 0.2274, -0.3814,  0.1191],
         [-0.2904,  0.1045,  0.0554],
         [-0.2849,  0.0445,  0.0482],
         [-0.1845,  0.0873,  0.0238],
         [-0.0345, -0.2270,  0.0302],
         [ 0.1494, -0.4512,  0.1380],
         [-0.1210, -0.1689,  0.0247],
         [ 0.1823,  0.1181,  0.0270],
         [ 0.2773, -0.2406,  0.0795],
         [-0.2336, -0.2106,  0.0576],
         [ 0.0968,  0.0054,  0.0053],
         [ 0.0320,  0.1482,  0.0131],
         [ 0.0163, -0.3847,  0.0879],
         [ 0.3435, -0.0910,  0.0743],
         [ 0.2130, -0.1744,  0.0438],
         [-0.1386,  0.1943,  0.0327],
         [-0.1008, -0.0846,  0.0098],
         [ 0.0786, -0.2043,  0.0274],
         [-0.2796, -0.0704,  0.0481],
         [ 0.2123, -0.2949,  0.0778],
         [-0.1370,  0.2219,  0.0392],
         [-0.0894,  0.0043,  0.0045],
         [-0.1910,  0.2611,  0.0611],
         [ 0.1299, -0.2853,  0.0572],
         [ 0.0426, -0.2584,  0.0395],
         [ 0.0970,  0.0344,  0.0060],
         [ 0.1993, -0.0168,  0.0228],
         [-0.0502,  0.0897,  0.0060],
         [-0.2241, -0.0820,  0.0327],
         [-0.0220, -0.0819,  0.0041],
         [-0.0635,  0.1416,  0.0137]]])

solution_successes, solution_bases, solution_indices, solution_errors, _ = im(
    reciprocal_spots.repeat(1, 1, 1),
    initial_cell,
    min_num_spots=8,
    angle_resolution=250,
    num_top_solutions=250
)

for success, basis, solution_mask, claimed_error in zip(
        solution_successes[0], solution_bases[0], solution_indices[0], solution_errors[0]
):
    print("Solution basis:")
    print(basis)
    print("Magnitud of solution basis(a, b, c):")
    print(basis.norm(dim=-1))
    miller_indices = torch.round(reciprocal_spots @ basis.T).int()
    print("Miller indices:")
    print((miller_indices * solution_mask[:, None]).p)

    break

